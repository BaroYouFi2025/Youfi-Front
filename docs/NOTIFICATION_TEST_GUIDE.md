# 알림 기능 테스트 가이드

## 테스트 시나리오

### 1. 알림 목록 조회 테스트

**목표**: 홈 화면에서 알림 목록이 제대로 표시되는지 확인

**절차**:
1. 앱 실행 및 로그인
2. 홈 화면으로 이동
3. "알림" 섹션 확인
4. Metro bundler 콘솔에서 로그 확인:
   - `📬 ========== 알림 조회 시작 ==========`
   - `📬 총 알림 개수: X`
   - `📬 읽지 않은 알림 개수: X`

**예상 결과**:
- 알림 박스에 알림 목록이 표시됨
- 최신 3개 알림만 표시됨
- 읽지 않은 알림은 배경색이 연한 파란색 (#f9fdfe)
- 읽지 않은 알림 우측 상단에 파란색 점 표시

---

### 2. 초대 요청 알림 테스트

**목표**: 초대 요청 알림의 수락/거절 기능 확인

**테스트 데이터 준비**:
- 백엔드에서 초대 요청 알림 생성 필요
- 또는 API를 통해 직접 생성

**절차**:
1. 홈 화면에서 초대 요청 알림 확인
2. 알림 아이템에 "수락", "거절" 버튼 확인
3. "수락" 버튼 클릭
4. Metro 콘솔에서 로그 확인:
   - `📬 초대 수락 시작: {id}`
   - `📬 초대 수락 성공`
5. 알림 목록이 자동으로 새로고침되는지 확인
6. "거절" 버튼 클릭 테스트

**예상 결과**:
- 수락 버튼: 파란색 배경 (#25b2e2), 흰색 텍스트
- 거절 버튼: 흰색 배경, 빨간색 테두리 (#ff6f61)
- 액션 후 알림 목록 자동 새로고침

---

### 3. 발견 신고 알림 테스트

**목표**: 발견 신고 알림에서 "자세히 보기" 클릭 시 발견되었다 페이지로 이동 확인

**절차**:
1. 홈 화면에서 발견 신고 알림 확인
2. 알림 아이템에 "자세히 보기" 버튼 확인
3. "자세히 보기" 버튼 클릭
4. 발견되었다 페이지로 이동 확인
5. 페이지 내용 확인:
   - "발견되었습니다" 배지
   - 프로필 이미지
   - 지도
   - 발견 위치 정보
   - 발견 정보 카드

**예상 결과**:
- `/person-found?notificationId={id}` 페이지로 이동
- 발견 정보가 제대로 표시됨
- 백 버튼으로 이전 화면으로 돌아갈 수 있음

---

### 4. 근처 알림 테스트

**목표**: 근처 알림의 "자세히 보기" 기능 확인

**절차**:
1. 홈 화면에서 근처 알림 확인
2. "자세히 보기" 버튼 클릭
3. 발견되었다 페이지로 이동 확인

**예상 결과**:
- 발견 신고와 동일하게 발견되었다 페이지로 이동

---

### 5. 알림 읽음 처리 테스트

**목표**: 알림을 읽음 처리했을 때 UI가 업데이트되는지 확인

**절차**:
1. 읽지 않은 알림 확인 (배경색과 점 표시 확인)
2. "자세히 보기" 클릭 (자동으로 읽음 처리)
3. 이전 화면으로 돌아가기
4. 알림이 읽음 상태로 변경되었는지 확인

**예상 결과**:
- 읽은 알림은 배경색이 없음
- 읽은 알림은 우측 상단 점이 사라짐

---

### 6. 알림 자동 새로고침 테스트

**목표**: 앱이 포그라운드에 있을 때 알림이 자동으로 새로고침되는지 확인

**절차**:
1. 홈 화면에서 알림 목록 확인
2. 앱을 백그라운드로 전환 (홈 버튼 누르기)
3. 30초 대기
4. 앱을 다시 포그라운드로 전환
5. Metro 콘솔에서 로그 확인:
   - `📬 앱이 포그라운드로 복귀 - 알림 조회 트리거`
   - `📬 주기적 알림 조회 트리거 (30초마다)`

**예상 결과**:
- 앱이 포그라운드로 돌아올 때 알림 목록 자동 새로고침
- 30초마다 자동 새로고침

---

### 7. 알림 없음 상태 테스트

**목표**: 알림이 없을 때 빈 상태 메시지가 표시되는지 확인

**절차**:
1. 알림이 없는 계정으로 로그인
2. 홈 화면 확인

**예상 결과**:
- 알림 박스에 "새로운 알림이 없습니다" 메시지 표시

---

### 8. 로딩 상태 테스트

**목표**: 알림을 불러오는 동안 로딩 인디케이터가 표시되는지 확인

**절차**:
1. 네트워크를 느리게 설정 (개발자 도구에서)
2. 홈 화면으로 이동
3. 알림 박스 확인

**예상 결과**:
- 로딩 중에는 ActivityIndicator 표시
- 로딩 완료 후 알림 목록 또는 빈 상태 메시지 표시

---

## API 테스트

### 알림 목록 조회 API 테스트

```bash
# curl을 사용한 테스트
curl -X GET "https://jjm.jojaemin.com/notifications/me" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json"
```

### 알림 읽음 처리 API 테스트

```bash
curl -X PUT "https://jjm.jojaemin.com/notifications/1/read" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json"
```

### 초대 수락 API 테스트

```bash
curl -X POST "https://jjm.jojaemin.com/notifications/1/accept-invitation" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"relation": "구성원"}'
```

### 초대 거절 API 테스트

```bash
curl -X POST "https://jjm.jojaemin.com/notifications/1/reject-invitation" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json"
```

### 발견 신고 상세 조회 API 테스트

```bash
curl -X GET "https://jjm.jojaemin.com/notifications/1/sighting" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json"
```

---

## 디버깅 팁

### 콘솔 로그 확인

알림 관련 모든 로그는 다음과 같은 이모지로 시작합니다:
- 📬: 알림 조회/처리 관련
- 📡: API 호출 관련
- ❌: 에러 관련

### 주요 로그 위치

1. **알림 조회**: `📬 ========== 알림 조회 시작 ==========`
2. **API 호출**: `📡 ========== 알림 API 호출 시작 ==========`
3. **에러 발생**: `❌ ========== 알림 로드 실패 ==========`

### 일반적인 문제 해결

1. **알림이 표시되지 않음**
   - 로그인 상태 확인
   - Access Token 유효성 확인
   - API 엔드포인트 확인

2. **알림 액션이 작동하지 않음**
   - 네트워크 연결 확인
   - API 응답 확인 (콘솔 로그)
   - 에러 메시지 확인

3. **발견되었다 페이지로 이동하지 않음**
   - 라우트 등록 확인 (`app/_layout.tsx`)
   - 파라미터 전달 확인
   - 콘솔 로그에서 `📬 자세히 보기 클릭` 확인

---

## 테스트 체크리스트

- [ ] 알림 목록 조회
- [ ] 초대 요청 알림 수락
- [ ] 초대 요청 알림 거절
- [ ] 발견 신고 알림 자세히 보기
- [ ] 근처 알림 자세히 보기
- [ ] 알림 읽음 처리
- [ ] 읽지 않은 알림 표시 (배경색, 점)
- [ ] 알림 자동 새로고침
- [ ] 알림 없음 상태
- [ ] 로딩 상태
- [ ] 발견되었다 페이지 이동
- [ ] 발견되었다 페이지 데이터 표시

